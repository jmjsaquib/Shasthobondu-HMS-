@{
    ViewBag.Title = "JobBag";
}
<script type="text/javascript" src="~/Scripts/jquery-barcode.min.js"></script>
<style type="text/css">
    body {
        margin: 0;
        padding: 0;
        font-size: 14px;
    }

    table {
        border-collapse: collapse;
        border-spacing: 0;
        width: 100%;
        border: 0px;
        padding: 0;
        margin: 0;
    }

        table tr td {
            margin: 0;
            padding: 2px;
        }

    td.box_R {
        border: 1px solid #666;
        text-align: right;
        font-weight: bold;
        padding-right: 10px;
    }

    td.box_L {
        border: 1px solid #666;
        padding-left: 10px;
    }

    td.rightBar {
        position: relative;
        width: 25%;
        text-align: center;
    }

        td.rightBar .roundRect {
            position: absolute;
            border-radius: 25px;
            border: 1px solid #666;
            top: 0px;
            left: 15px;
            right: 0px;
            bottom: 0px;
            margin-left: auto;
            margin-right: auto;
        }

    .roundRect .blockText {
        font-size: 32px;
        font-family: arial;
        position: absolute;
        top: 30%;
        left: 0;
        right: 0;
        bottom: 0;
        width: 600px;
        height: 400px;
    }

    td.col25 {
        width: 25%;
    }

    td.col33 {
        width: 33%;
    }

    td.col50 {
        width: 50%;
    }

    td.col75 {
        width: 75%;
    }

    .rotate90 {
        /* Safari */
        -webkit-transform: rotate(-90deg);
        /* Firefox */
        -moz-transform: rotate(-90deg);
        /* IE */
        -ms-transform: rotate(-90deg);
        /* Opera */
        -o-transform: rotate(-90deg);
        /* Internet Explorer */
        filter: progid:DXImageTransform.Microsoft.BasicImage(rotation=3);
    }

    .ronny {
        float: left;
        width: 30% !important;
    }
</style>
<script type="text/javascript">
    $(document).ready(function () {

        var order_code = '@ViewBag.order_code';
        var common_data = '@ViewBag.CommonData';
        common_data = common_data.replace(/&quot;/g, '"');
        var label_reference_id = '@ViewBag.labelRefId';
        common_data = JSON.parse(common_data);
        console.log('@ViewBag.VariableData');

        $.ajax({
            type: "GET",
            url: "@UrlConfig.Action("GetCustomerAddress", "OrderSchemamappingPartial")?order_code=" + order_code,
            dataType: "json",
            success: function (data) {
                console.log(data);
                $("#order_code").html(data[0].order_code);
                $("#issue_date").html(data[0].order_date);
                $("#erp_date").html(data[0].order_date);
                $("#customer_name").html(data[0].customer_name);
                $("#billing_address").html(data[0].billing_address_1);
                $("#billing_city").html(data[0].billing_city_name);
                $("#billing_country").html(data[0].billing_country_name);
                $("#billing_zip").html(data[0].billing_zip_code);
                $("#ship_address").html(data[0].shipping_address_1);
                $("#ship_city").html(data[0].shipping_city_name);
                $("#ship_country").html(data[0].shipping_country_name);
                $("#ship_zip").html(data[0].shipping_zip_code);
                $("#rbo_name").html(common_data[0].rbo_name);
                $("#label_name").html(common_data[0].label_type_name);
                $("#customer_po").html(data[0].customer_po);
                $("#quantity").html('@ViewBag.quantity');
                $("#jobBag").html(data[0].order_code);
            }
        });
        $.ajax({
            type: "GET",
            url: "@Url.Action("Details", "PmxLabelReference")?label_reference_id=25",
            dataType: "json",
            success: function (data) {
                console.log(data);
                $('#item_spec').html(data);
            }
        });

        /* Maruf:14-Feb-2016 */
        $('#dynaWs').empty();
        $.ajax({
            type: "GET",
            url: "@UrlConfig.Action("GetWorkstationsByOrderCode", "ProductLineMaster")?order_code=" + order_code,
            dataType: "json",
            success: function (result) {
                console.log("========== Workstation Data Start =============");
                console.log(result);
                result.forEach(function (row) {
                    var strWs = '<br /><b>' + row.work_center_name + ':</b>' +
                                '<table><tr>' +
                                      '<td class="box_R col33">Issued By:</td>' +
                                      '<td class="box_L col33">Issued QTY:</td>' +
                                      '<td class="box_L col33">Issued Date:</td> ' +
                                '</tr><tr>' +
                                      '<td class="box_L text-right" style="min-height:20px;">' + row.started_by + '&nbsp;</td>' +
                                      '<td class="box_L" style="min-height:20px;"></td>' +
                                      '<td class="box_L" style="min-height:20px;">' + row.start_date + '</td>' +
                                '</tr></table>';
                    $('#dynaWs').append(strWs);
                });
                console.log("========== Workstation Data End =============");

            }
        });
    });
</script>
<div class="widget" style="margin-top: 20px !important">
    <div class="widget-body">
        <div id="bcTarget" style="width: 150px; float: right"></div>
        <table>
            <tr>
                <td>
                    <table>
                        <tr>
                            <td class="box_R">Job Bag No:</td>
                            <td class="box_L"><span id="order_code"></span></td>
                            <td class="box_R">Issue Date:</td>
                            <td class="box_L"><span id="issue_date"></span></td>
                        </tr>
                        <tr>
                            <td class="box_R">Retailer Name:</td>
                            <td class="box_L"><span id="rbo_name"></span></td>
                            <td class="box_R">ERD Date:</td>
                            <td class="box_L"><span id="erp_date"></span></td>
                        </tr>
                        <tr>
                            <td class="box_R">Customer Name:</td>
                            <td class="box_L"><span id="customer_name"></span></td>
                            <td class="box_R">Process:</td>
                            <td class="box_L">OFFSET</td>
                        </tr>
                        <tr>
                            <td class="box_R">Bill To Party:</td>
                            <td class="box_L"><span id="billing_address"></span>,<span id="billing_city"></span>,<span id="billing_country"></span>-<span id="billing_zip">.</span></td>
                            <td class="box_R">Quantity:</td>
                            <td class="box_L"><span id="quantity"></span></td>
                        </tr>
                        <tr>
                            <td class="box_R">Ship To Party:</td>
                            <td class="box_L"><span id="ship_address"></span>,<span id="ship_city"></span>,<span id="ship_country"></span>-<span id="ship_zip">.</span></td>
                            <td class="box_R">Priority Level:</td>
                            <td class="box_L">High</td>
                        </tr>
                        <tr>
                            <td class="box_R">Label Name:</td>
                            <td class="box_L"><span id="label_name"></span></td>
                            <td class="box_R">Customer Ref:</td>
                            <td class="box_L"><span id="customer_po"></span></td>
                        </tr>
                    </table>
                </td>
            </tr>
            <tr><td>&nbsp;</td></tr>
            <tr>
                <td>
                    <table>
                        <tr>
                            <td><b>PRE-PRESS &amp; DP:</b></td>
                            <td>&nbsp;</td>
                            <td><b><span id="dp_name"></span></b></td>
                        </tr>
                    </table>
                </td>
            </tr>
            <tr>
                <td>
                    <table>
                        <tr>
                            <td>
                                <table>
                                    <tr>
                                        <td>
                                            <table>
                                                <tr>
                                                    <td class="box_R col33">Film Processed by &amp; Date:</td>
                                                    <td class="box_L col33"><span id="flim_process_date"></span></td>
                                                    <td class="box_L col33">12 -Feb-2016</td>
                                                </tr>
                                                <tr>
                                                    <td class="box_R">MO/ Job No:</td>
                                                    <td class="box_L"><span id="mo_no"></span></td>
                                                    <td class="box_L">&nbsp;</td>
                                                </tr>
                                                <tr>
                                                    <td class="box_R">Final Film Chaked by &amp; Date:</td>
                                                    <td class="box_L"><span id="flim_process_date"></span></td>
                                                    <td class="box_L"><span id="flim_process_date"></span></td>
                                                </tr>
                                            </table>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <br />
                                            <b>PLANNING:</b>
                                            <table>
                                                <tr>
                                                    <td class="box_R col25">Recived Date:</td>
                                                    <td class="box_L col25"><span id="flim_process_date"></span></td>
                                                    <td class="box_R col25">Pass Date:</td>
                                                    <td class="box_L col25"><span id="flim_process_date"></span></td>
                                                </tr>
                                                <tr>
                                                    <td class="box_R">Machine Name:</td>
                                                    <td class="box_L"><span id="flim_process_date"></span></td>
                                                    <td class="box_R">Machine Number:</td>
                                                    <td class="box_L"><span id="flim_process_date"></span></td>
                                                </tr>
                                            </table>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <br /><b>PRODUCTION:</b>
                                            <table>
                                                <tr>
                                                    <td class="box_R col25">Production In-Charge:</td>
                                                    <td class="box_L col25"><span id="flim_process_date"></span></td>
                                                    <td class="box_R col25"><span id="flim_process_date"></span></td>
                                                    <td class="box_L col25">&nbsp;</td>
                                                </tr>
                                                <tr>
                                                    <td class="box_R">Number of UPS:</td>
                                                    <td class="box_L"><span id="flim_process_date"></span></td>
                                                    <td class="box_R">Number Of Plate:</td>
                                                    <td class="box_L"><span id="flim_process_date"></span></td>
                                                </tr>
                                                <tr>
                                                    <td class="box_R">Required Material:</td>
                                                    <td class="box_L"><span id="flim_process_date"></span></td>
                                                    <td class="box_R">&nbsp;</td>
                                                    <td class="box_L">&nbsp;</td>
                                                </tr>
                                            </table>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <br /><b>STORE:</b>
                                            <table>
                                                <tr>
                                                    <td class="box_R col33">Material Name:</td>
                                                    <td class="box_L col33"><span id="flim_process_date"></span></td>
                                                    <td class="box_L col33">&nbsp;</td>
                                                </tr>
                                                <tr>
                                                    <td class="box_R">Issued By:</td>
                                                    <td class="box_L">Issued QTY:</td>
                                                    <td class="box_L">Issued Date:</td>
                                                </tr>
                                                <tr>
                                                    <td class="box_R" style="min-height:20px;"><span id="flim_process_date">Mr. Parveg</span></td>
                                                    <td class="box_L" style="min-height:20px;"><span id="flim_process_date"></span></td>
                                                    <td class="box_L" style="min-height:20px;"><span id="flim_process_date"></span></td>
                                                </tr>
                                            </table>
                                        </td>
                                    </tr>
                                    <!-- Maruf: dynamic Workstations by production line start -->
                                    <tr>
                                        <td>
                                            <div id="dynaWs"></div>
                                        </td>
                                    </tr>
                                    <!-- Maruf: dynamic Workstations by production line end -->
                                    <tr>
                                        <td>
                                            <br /><b>DISPATCH/LOGISTICS:</b>
                                            <table>
                                                <tr>
                                                    <td class="box_R col33">Recived by &amp; Date:</td>
                                                    <td class="box_L col33"><span id="flim_process_date"></span></td>
                                                    <td class="box_L col33"><span id="flim_process_date"></span></td>
                                                </tr>
                                                <tr>
                                                    <td class="box_R">&nbsp;</td>
                                                    <td class="box_L"><span id="flim_process_date"></span></td>
                                                    <td class="box_L"><span id="flim_process_date"></span></td>
                                                </tr>
                                            </table>
                                        </td>
                                    </tr>
                                </table>
                            </td>
                            <td class="rightBar"><div class="roundRect"><div class="rotate90 blockText">PRODUCTION SAMPLE</div></div></td>
                        </tr>
                    </table>
                </td>
            </tr>
        </table>
        <style type="text/css">
            .grid_main td {
                border: 1px solid gray;
                border-collapse: collapse;
                padding-left: 5px;
            }

            .grid_main th {
                border: 1px solid gray;
                border-collapse: collapse;
                background-color: whitesmoke;
                padding-left: 5px;
            }
        </style>
        <br />
        <div class="">
            <div class="panel-heading"><b>Item Information</b></div>
            <div class="panel-body">
                <div id="kWindow"></div>
                <table>
                    <tr class="col-md-6">
                        <td class="col-md-4">
                            <label for="label_type" style="font-size:14px;">Product Name</label>
                        </td>
                        <td class="col-md-8">
                            <span id="label_reference_name"></span>
                        </td>
                    </tr>

                    <tr class="col-md-6">
                        <td class="col-md-4">
                            <label for="rbo_id" style="font-size:14px;">RBO Name</label>
                        </td>
                        <td class="col-md-8">
                            <span id="rbo_id"></span>
                        </td>
                    </tr>
                    <tr class="col-md-6">
                        <td class="col-md-4">
                            <label for="label_type" style="font-size:14px;">Label Type</label>
                        </td>
                        <td class="col-md-8">
                            <span id="label_type"></span>
                        </td>
                    </tr>
                    <tr class="col-md-6">
                        <td class="col-md-4">
                            <label for="program_id" style="font-size:14px;">Program Name</label>
                        </td>
                        <td class="col-md-8">
                            <span id="program_id"></span>
                        </td>
                    </tr>
                    <tr class="col-md-6">
                        <td class="col-md-4">
                            <label style="font-size:14px;">Manufacture Lead Time</label>
                        </td>
                        <td class="col-md-8">
                            <span id="manufacture_lead_time"></span>
                        </td>
                    </tr>

                    <tr class="col-md-6">
                        <td class="col-md-4"><label style="font-size:14px;">Posting Group</label></td>
                        <td class="col-md-8">
                            <span id="product_posting_group"></span>
                        </td>
                    </tr>
                    <tr class="col-md-6">
                        <td class="col-md-4">
                            <label style="font-size:14px;">Sales Price</label>
                        </td>
                        <td class="col-md-8">
                            <span id="sales_price"></span>
                        </td>
                    </tr>

                    <tr class="col-md-6">
                        <td class="col-md-4">
                            <label style="font-size:14px;">HS Code</label>
                        </td>
                        <td class="col-md-8">
                            <span id="hscode"></span>
                        </td>
                    </tr>

                    <tr id="label_ref_veriable" class="hide"></tr>
                </table>

            </div>
        </div>
        <table id="pmxSections"></table>
        <input type="hidden" id="totalSection" />
        <br /><br />
        <b>Order Details For Job Bag No -<span id="jobBag"></span></b>

        <table class="grid_main" style="border: 1px solid gray; border-collapse:collapse">
            <tr>
                @foreach (var col in ViewBag.VariableData.Columns)
                {
                    <th id="gridHeader" style="white-space: nowrap;">
                        @col
                    </th>
                }
            </tr>

            @foreach (System.Data.DataRow row in ViewBag.VariableData.Rows)
            {
                <tr>
                    @foreach (System.Data.DataColumn col in ViewBag.VariableData.Columns)
                    {
                        <td>
                            @row[col.ColumnName]
                        </td>
                    }
                </tr>
            }
        </table>
        <br />
    </div>
</div>
<script type="text/javascript">
    var order_code = '@ViewBag.order_code';
    $("#bcTarget").barcode(order_code, "code128");
</script>

<script type="text/javascript">

    //here Session["user_au_id"] is to get user_id--
    @{
        string user_id = "";
        if (Session["user_au_id"] != null)
        {
            user_id = (string) Session["user_au_id"];
        }
    }

    @{
        string companyId = "";
        if (Session["company_id"] != null)
        {
            companyId = (string) Session["company_id"];
        }
    }

    $(document).ready(function () {
        var company_id = '@companyId';
        var user_id = '@user_id';
        var sections = [];
        var label_reference_id = 25;//'@ViewBag.labelRefId';
        var label_type_id = "";

        var datasorce = [];
        var fields = {
            'id': { 'type': 'number' },
            'height_mm': { 'type': 'number' },
            'height_inch': { 'type': 'number' },
            'width_mm': { 'type': 'number' },
            'width_inch': { 'type': 'number' },
            'quality': { 'type': 'string' },
            'picks': { 'type': 'string' },
            'accross': { 'type': 'across' }
        };

        var Columns = [
            { 'field': 'height_mm', 'title': 'Height(mm)', 'width': '70px', 'height': '50px' },
            { 'field': 'height_inch', 'title': 'Height(inch)', 'width': '70px', 'height': '50px' },
            { 'field': 'width_mm', 'title': 'Width(mm)', 'width': '70px', 'height': '50px' },
            { 'field': 'width_inch', 'title': 'Width(inch)', 'width': '70px', 'height': '50px' },
            { 'field': 'quality', 'title': 'Quality', 'width': '70px', 'height': '50px' },
            { 'field': 'picks', 'title': 'Picks', 'width': '70px', 'height': '50px' },
            { 'field': 'across', 'title': 'Across', 'width': '70px', 'height': '50px' }
            //,{ 'command': 'destroy', 'title': 'Delete', width: 150 }
        ];

        jQuery('#label_ref_veriable').kendoGrid({
            remove: function (e) {
                var grid = $('#label_ref_veriable').data('kendoGrid');
                grid.refresh();
            },
            save: function (e) {
                //console.log(e);
                console.log(e.values.height_mm);
                if (typeof e.values.height_mm !== "undefined") {

                    /* start calculate height for inch
                       formula: mm ÷ 25.4 = in
                    */
                    if (e.values.height_mm >= 1) {
                        var mmValue = parseFloat(e.values.height_mm.toString());
                        var inchValue = parseFloat(mmValue / 25.4).toFixed(2);
                        e.model.set("height_inch", inchValue);
                    } else {
                        e.model.set("height_inch", 0);
                    }
                    /* end calculate height with inch  */
                    console.log('height_mm work');
                }

                if (typeof e.values.height_inch !== "undefined") {

                    /* start calculte height for mm
                       formula:in x 25.4 = mm
                    */
                    if (e.values.height_inch >= 1) {
                        var inchValueformm = parseFloat(e.values.height_inch.toString());
                        var mmValueForInch = parseFloat(inchValueformm * 25.4).toFixed(2);
                        e.model.set('height_mm', mmValueForInch);
                    } else {
                        e.model.set('height_mm', 0);
                    }

                    /* end calculate height with inch */
                    console.log('height_inch work');

                }

                if (typeof e.values.width_mm !== "undefined") {

                    /* start calculate height for mm
                      formula: mm ÷ 25.4 = in
                    */

                    if (e.values.width_mm >= 1) {
                        var widthValuemm = parseFloat(e.values.width_mm.toString());
                        var widthValueInch = parseFloat(widthValuemm / 25.4).toFixed(2);
                        e.model.set('width_inch', widthValueInch);
                    } else {
                        e.model.set('width_inch', 0);
                    }

                    console.log('width_mm work');

                }

                if (typeof e.values.width_inch !== "undefined") {

                    if (e.values.width_inch >= 1) {
                        var widthInchValue = parseFloat(e.values.width_inch.toString());
                        var widthValuemmx = parseFloat(widthInchValue * 25.4).toFixed(2);
                        e.model.set('width_mm', widthValuemmx);
                    } else {
                        e.model.set('width_mm', 0);

                    }

                    console.log('width_inch work');

                }

                console.log(e.values.height_inch);
                console.log(e.values.width_inch);
                console.log(e.values.width_mm);

            },
            selectable: true,
            dataSource: {
                data: datasorce,
                schema: {
                    model: { id: "id", fields: fields }
                },
                pageSize: 20
            },
            //scrollable: true, toolbar: ['create'],
            columns: Columns,
            editable: false
        });

        // for edit *******************************************

        $.ajax({
            type: "GET",
            url: "@UrlConfig.Action("GetLabelReferenceInfoById", "PmxLabelReference")",
            data: { label_reference_id: label_reference_id },
            dataType: "json",
            contentType: "application/json",
            success: function (data) {
                console.log(data);

                //$("#prdImg").attr("src", "@UrlConfig.HttpRouteUrl()" + "Images/LabelReference/" + data.oLabelReference.label_reference_image);
                //$("#prdImgLink").attr("href", "@UrlConfig.HttpRouteUrl()" + "Images/LabelReference/" + data.oLabelReference.label_reference_image);

                $("#label_reference_name").html(data.oLabelReference.label_reference_name);
                label_type_id = data.oLabelReference.label_type_id;
                $("#label_type").html(data.label_type_name);
                $("#program_id").html(data.program_name);
                $("#rbo_id").html(data.rbo_name);
                $("#product_posting_group").html(data.product_posting_group_name);

                $("#manufacture_lead_time").html(data.manufacture_lead_time);
                $("#sales_price").html(data.sales_price);
                $("#hscode").html(data.hscode);

                $('#label_ref_veriable').data('kendoGrid').dataSource.data(data.oPmxLebelReferenceRecordModel);

                loadDesign();
            }
        });

        // for edit *******************************************
        function loadDesign() {
            //console.log(label_type_id);
            $.getJSON("@UrlConfig.Action("getAllLabelTypeSectionWithPropertiesForEdit", "PmxLabelTypeSectionMapping")?company_id=" + '@companyId' + "&pmx_label_type_id=" + label_type_id + "&label_reference_id=" + label_reference_id, function (data) {
                var sectionHTML = "";
                if (data.length >= 1) {

                    $(data).each(function (index, section) {
                        console.log("Rimon");
                        console.log(section.pmx_label_type_common_properties_with_value.length);

                        if (section.pmx_label_type_common_properties_with_value.length >= 1 && section.pmx_label_type_variable_properties.length >= 1) {
                            sections.push({ "section_id": section.pmx_presentation_section_id, "section_name": section.pmx_section_name, "variable_field": true });
                        } else if (section.pmx_label_type_common_properties_with_value.length <= 0 && section.pmx_label_type_variable_properties.length >= 1) {
                            sections.push({ "section_id": section.pmx_presentation_section_id, "section_name": section.pmx_section_name, "variable_field": true });

                        } else {
                            sections.push({ "section_id": section.pmx_presentation_section_id, "section_name": section.pmx_section_name, "variable_field": false });
                        }

                        sectionHTML += '<div class="">';
                        sectionHTML += '<div class="panel-heading"><b>' + section.pmx_section_name + '</b></div>';
                        sectionHTML += '<div class="panel-body">';

                        /** start common properties sections **/

                        if (section.pmx_label_type_common_properties_with_value.length >= 1) {
                            sectionHTML += '<div class="row">';
                            var x = 1;
                            $.each(section.pmx_label_type_common_properties_with_value, function (index, frmelements) {
                                //console.log(frmelements);
                                if (x == 3) {
                                    sectionHTML += "<div class='clearfix'></div>";
                                    x = 0;
                                }

                                sectionHTML += '<div class="ronny" style="padding: 10px; font-size-14px;"> <b>';
                                sectionHTML += frmelements.property_name;
                                sectionHTML += ': &nbsp;&nbsp;&nbsp; </b>';

                                if (frmelements.property_type_id == 1) {
                                    var prop_value_id = 'section_' + section.pmx_presentation_section_id + '_pp_' + frmelements.property_type_id + '_prop_' + frmelements.property_id + '_id';
                                    var prop_value_name = 'section_' + section.pmx_presentation_section_id + '_pp_' + frmelements.property_type_id + '_prop_' + frmelements.property_id + '_name';
                                    //sectionHTML += '<input style="width:80%" class="k-textbox" type="text" value="' + frmelements.field_value + '" id="' + prop_value_id + '" name="' + prop_value_id + '_input">';
                                    sectionHTML += '<span>' + frmelements.field_value + '</span>';
                                } else if (frmelements.property_type_id == 4) { //Drop Down
                                    var prop_value_id = 'section_' + section.pmx_presentation_section_id + '_pp_' + frmelements.property_type_id + '_prop_' + frmelements.property_id + '_id';
                                    var prop_value_name = 'section_' + section.pmx_presentation_section_id + '_pp_' + frmelements.property_type_id + + '_prop_' + frmelements.property_id + '_name';

                                    var url = "@UrlConfig.Action("GetSubPropertyValuesForForm", "PmxLabelTypeSubProperty")?property_id=" + frmelements.property_id + "&idName=" + prop_value_id + "&valueName=" + prop_value_name + "";
                                    sectionHTML += '<input style="width:80%" type="text" value="' + frmelements.field_value + '" id="' + prop_value_id + '" name="' + prop_value_id + '">';
                                    sectionHTML += '<script type="text/javascript">';
                                    sectionHTML += '$("#' + prop_value_id + '").kendoDropDownList({';
                                    sectionHTML += 'placeholder: "Select...",';
                                    sectionHTML += 'dataTextField: "' + prop_value_name + '",';
                                    sectionHTML += 'dataValueField: "' + prop_value_id + '",';
                                    sectionHTML += 'dataSource: {';
                                    sectionHTML += 'transport: {';
                                    sectionHTML += ' read: {';
                                    sectionHTML += ' url: "' + url + '",';
                                    sectionHTML += ' type: "GET"';
                                    sectionHTML += '}';
                                    sectionHTML += '},';
                                    sectionHTML += '}';
                                    sectionHTML += '}).data("kendoDropDownList");';
                                    sectionHTML += '<\/script>';

                                } else if (frmelements.property_type_id == 5) { //ComboBox Box
                                    var prop_value_id = 'section_' + section.pmx_presentation_section_id + '_pp_' + frmelements.property_type_id + '_prop_' + frmelements.property_id + '_id';
                                    var prop_value_name = 'section_' + section.pmx_presentation_section_id + '_pp_' + frmelements.property_type_id + '_prop_' + frmelements.property_id + '_name';
                                    var url = "@UrlConfig.Action("GetSubPropertyValuesForForm", "PmxLabelTypeSubProperty")?property_id=" + frmelements.property_id + "&idName=" + prop_value_id + "&valueName=" + prop_value_name + "";
                                    sectionHTML += '<input style="width:80%" type="text" value="' + frmelements.field_value + '" id="' + prop_value_id + '" name="' + prop_value_id + '">';
                                    sectionHTML += '<script type="text/javascript">';
                                    sectionHTML += '$("#' + prop_value_id + '").kendoComboBox({';
                                    sectionHTML += 'placeholder: "Select...",';
                                    sectionHTML += 'dataTextField: "' + prop_value_name + '",';
                                    sectionHTML += 'dataValueField: "' + prop_value_id + '",';
                                    sectionHTML += 'dataSource: {';
                                    sectionHTML += 'transport: {';
                                    sectionHTML += ' read: {';
                                    sectionHTML += ' url: "' + url + '",';
                                    sectionHTML += ' type: "GET"';
                                    sectionHTML += '}';
                                    sectionHTML += '},';
                                    sectionHTML += '}';
                                    sectionHTML += '}).data("kendoComboBox");';
                                    sectionHTML += '<\/script>';
                                }

                                sectionHTML += "</div>";

                                x++;
                            });

                            sectionHTML += '</div>';
                        }
                        /** end common properties section      **/

                        /** start common properties section    **/

                        if (section.pmx_label_type_variable_properties.length >= 1) {
                            sectionHTML += '<br />';
                            sectionHTML += "<div class='row'>";
                            /** start create HTML Div and init the javascript **/
                            sectionHTML += "<div id=\"grid_" + section.pmx_presentation_section_id + "\"></div>";
                            sectionHTML += "<script type=\"text/javascript\">";
                            sectionHTML += "jQuery(document).ready(function () {";
                            sectionHTML += "var datasorce = [];";

                            var Columns = " [";
                            var fields = "{ ";

                            $.each(section.pmx_label_type_variable_properties, function (index, frmelements) {
                                //console.log(frmelements);
                                var PropertyTypeId = frmelements.property_type_id;
                                var property_field_id = "prop_" + frmelements.property_id;
                                var property_field_title = frmelements.property_name;
                                var prop_value_name = "prop_" + frmelements.property_id + "_name";
                                var param = "options.field";
                                if (frmelements.property_type_id == 4) {

                                    Columns += "{'field': '" + property_field_id + "', 'title': '" + property_field_title + "', 'width': '150px', 'editor':";
                                    Columns += " function(container, options) {";
                                    Columns += " jQuery('<input data-text-field=\"" + prop_value_name + "\" data-value-field=\"" + property_field_id + "\" data-bind=\"value:'+ " + param + " +'\" />')";
                                    Columns += " .appendTo(container)";
                                    Columns += " .kendoDropDownList({";

                                    Columns += " dataSource:  {";
                                    Columns += " transport: {";
                                    Columns += " read: {";
                                    Columns += " url:'" + "@UrlConfig.Action("GetSubPropertyValuesForForm", "PmxLabelTypeSubProperty")?property_id=" + frmelements.property_id + "&idName=" + property_field_id + "&valueName=" + prop_value_name + "'";
                                    Columns += "}";
                                    Columns += "}";
                                    Columns += "},";

                                    Columns += "select: function (e) {";
                                    Columns += "var dataItem = this.dataItem(e.item);";

                                    Columns += 'var grid = $("#grid_' + section.pmx_presentation_section_id + '").data("kendoGrid");';
                                    Columns += 'var sel = grid.select();';
                                    Columns += 'var sel_idx = sel.index();';
                                    Columns += 'var gridData = grid.dataSource.data();';
                                    //Columns += 'console.log("working");';

                                    Columns += 'gridData[sel_idx].' + prop_value_name + ' = dataItem.' + prop_value_name + ';';
                                    Columns += 'gridData[sel_idx].' + property_field_id + ' = dataItem.' + property_field_id + ';';
                                    Columns += 'grid.refresh();';

                                    Columns += "},";

                                    Columns += "optionLabel: \"Select property\"";
                                    Columns += " });";
                                    Columns += "},";

                                    Columns += 'template:"#=' + prop_value_name + '#"},';

                                    fields += "'" + property_field_id + "': { 'type': 'string'},";
                                    fields += "'" + prop_value_name + "': { 'type': 'string'},";

                                } else {
                                    Columns += "{ 'field': '" + property_field_id + "', 'title': '" + property_field_title + "', 'width': '60px', 'height':'50px'},";
                                    fields += "'" + property_field_id + "': { 'type': 'string'},";

                                }

                            });
                            Columns += "];";
                            fields += "}";

                            sectionHTML += "var fields =" + fields + ";";

                            sectionHTML += "var Columns =" + Columns;

                            /** End create HTML Div and init the javascript **/

                            sectionHTML += "jQuery('#grid_" + section.pmx_presentation_section_id + "').kendoGrid({";
                            sectionHTML += "remove:function(e) {";
                            sectionHTML += "var grid = $('#grid_" + section.pmx_presentation_section_id + "').data('kendoGrid');";
                            sectionHTML += "grid.refresh();";
                            sectionHTML += "},";
                            sectionHTML += "selectable: true,";
                            sectionHTML += "dataSource: {";
                            sectionHTML += "data: datasorce,";
                            sectionHTML += "schema: {";
                            sectionHTML += "model: {";
                            sectionHTML += "fields: fields";
                            sectionHTML += "}";
                            sectionHTML += "},";
                            sectionHTML += "pageSize: 20";
                            sectionHTML += "},";
                            sectionHTML += "scrollable: true,";
                            //sectionHTML += "toolbar: ['create'],";
                            // sectionHTML += "sortable: false,";
                            // sectionHTML += "filterable: false,";
                            // sectionHTML += "pageable: true,";
                            sectionHTML += "columns:Columns,";
                            //sectionHTML += "editable:{ mode: \"incell\", createAt: \"bottom\"}";
                            sectionHTML += "editable:false";
                            sectionHTML += "});";
                            /** End Creating Grid View    **/

                            /**  End HTML Div and End the javascript **/
                            sectionHTML += "});";

                            sectionHTML += '$.ajax({';
                            sectionHTML += '    type: "GET",';
                            sectionHTML += '    url: "@UrlConfig.Action("getLabelTypeSectionVariablesDataForEdit", "PmxLabelTypeSectionMapping")",';
                            sectionHTML += '    data: {';
                            sectionHTML += '        pmx_label_type_id: ' + label_type_id + ',';
                            sectionHTML += '        pmx_presentation_section_id: ' + section.pmx_presentation_section_id + ',';
                            sectionHTML += '        label_reference_id: ' + label_reference_id;
                            sectionHTML += '    },';
                            sectionHTML += '    dataType: "json",';
                            sectionHTML += '    contentType: "application/json",';
                            sectionHTML += '    success: function (data) {';
                            sectionHTML += '        $("#grid_' + section.pmx_presentation_section_id + '").data("kendoGrid").dataSource.data(data);';
                            sectionHTML += '    }';
                            sectionHTML += '});';

                            sectionHTML += "<\/script>";
                            sectionHTML += "</div>";
                            /** End HTML Div and End the javascript **/

                        }
                        /** end common properties section       **/
                        sectionHTML += '</div>';
                        sectionHTML += ' </div>';
                    });

                    $("#pmxSections").html('');
                }
                $("#pmxSections").html(sectionHTML);
            });
        }



        $("#btnAddNewLabelReference").click(function () {
            var frmdData = $("#frmLabelReferenceAdd").serializeArray();

            var frmCommonData = JSON.stringify(frmdData);
            var frmData = new FormData();
            frmData.append("common_data", frmCommonData);

            var lablerefFiles = $("#files").get(0).files;
            if (lablerefFiles.length > 0) {
                frmData.append("label_reference_image", lablerefFiles[0]);
            }

            frmData.append("sections", JSON.stringify(sections));
            frmData.append("company_id", company_id);
            frmData.append("label_reference_id", label_reference_id);
            frmData.append("label_type", $("#label_type").val());
            frmData.append("rbo_id", $("#rbo_id").val());

            var label_ref_varient = JSON.stringify($("#label_ref_veriable").data("kendoGrid").dataSource.data());
            frmData.append('label_ref_varient', label_ref_varient);

            $(sections).each(function (index, section) {

                if (section.variable_field === true) {
                    var gridKey = "#grid_" + section.section_id;
                    var tempGridData = JSON.stringify($(gridKey).data("kendoGrid").dataSource.data());
                    var dataKey = "variable_" + section.section_id;
                    frmData.append(dataKey, tempGridData);
                }
            });
            //console.log(frmData);
            $.ajax({
                type: "PUT",
                url: "@UrlConfig.Action("Put", "PmxLabelReference")",
                data: frmData,
                processData: false,
                contentType: false,
                success: function (returnData) {
                    console.log(returnData.returnValue);

                    var splitValue = returnData.returnvalue.split(',');

                    var splitLabelReference = splitValue[0];
                    var splitRboId = splitValue[1];
                    var splitLabelTypeId = splitValue[2];


                    KendoWindowFunction(returnData.msg, "success", "");
                }
            });

        });

    });
</script>